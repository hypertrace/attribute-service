name: Update Gradle lockfiles and raise PR
description: If any lockfiles are outdated, updates them and raises a pull request

runs:
  using: composite
  steps:
    - name: Update lockfiles
      uses: hypertrace/github-actions/gradle@main
      with:
        args: resolveAndLockAll --write-locks
    - name: Check if git dirty
      id: git-dirty
      shell: sh
      run: |
        dirty=test -n "$(git status --porcelain)" && echo true || echo false
        echo $dirty
        echo dirty=$dirty >> $GITHUB_OUTPUT
    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v5
      if: ${{ steps.git-dirty.outputs.dirty }}
      with:
        title: Update gradle locks (Automated)
        body: |
          # Autogenerated gradle lock updates
        commit-message: Update gradle locks
        delete-branch: true
        branch-suffix: timestamp
